<!DOCTYPE html>
<head>
	<title>LoopBack</title>
	<script src="//www.chartjs.org/assets/Chart.min.js"></script>
	<script src="/js/underscore.js"></script>
	<script src="/js/jquery.js"></script>
	<script src="/js/bluebird.min.js"></script>
	<script src="/js/utils.js"></script>
	<script src="/js/line-chart.js"></script>
	<!--  Material Dashboard CSS    -->
    <link href="/material/css/material-dashboard.css" rel="stylesheet"/>
</head>
<body>
    <h1>Device Viewer</h1>
    <ul id="sensorsList"></ul>
    <!-- <canvas id="latestTemporalChart" width="1000" height="300"></canvas> -->
</body>
<script>
	var deviceId = "{{ deviceId }}"

	requestBackEnd(
 		{ deviceId: deviceId, token: token }, 
 		"/deviceProfile"
 	).then(function (deviceProfile) {
		var sensors    = deviceProfile.sensors,
			deviceName = deviceProfile.name,
			online     = deviceProfile.online,
			active     = deviceProfile.active,
			desc       = deviceProfile.description,
			deviceCreatedAt = deviceProfile.created_at,
			deviceUpdatedAt = deviceProfile.updated_at;

		var sensorListStr = "";
		_.map(sensors, function (sensor) {
			sensorListStr += String.format(
	            '<li> <a href="/dashboard/sensor/{0}">Click to view</a> Sensor Name: {1}, \
	            Data Source: {2}, Data Type: {3}, Created At: {4}, Updated At: {5} \
	            <canvas id="latestTemporalChart_{0}" width="1000" height="300"></canvas></li>', 
	            sensor.id, sensor.name, sensor.data_source,
	            sensor.data_type, sensor.created_at, sensor.updated_at);
		}); 
		document.getElementById("sensorsList").innerHTML = sensorListStr;

		_.map(sensors, function (sensor) {
		 	lineChart.liveLine(
				{ sensorId: sensor.id, token: token },
				"/sensorLatestTemporalView",
				String.format("latestTemporalChart_{0}", sensor.id), 
				5000
			);
		});
 	})

	
</script>